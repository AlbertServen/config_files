{"mode":"editor","version":1,"windowDimensions":{"x":2,"y":109,"width":1046,"height":1569,"maximized":false},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"project":{"paths":["/home/bellahora-04/Downloads/portal"],"buffers":[{"text":"var _ = require('underscore'),\n\tbcrypt = require('bcryptjs'),\n\tpathModels = '../common/model',\n\twhen = require('promised-io/promise'),\n\tMapper = require('../common/utils/mapper.js'),\n\tBaseController = require('./abstract/BaseController.js'),\n\tcrypto = require('crypto'),\n\tlogger = require('../common/utils/logentries')(),\n\tipware = require('ipware')(),\n\tLogUser = require('../common/model/LogUserActivity').model(),\n\tUserPainter = require('../painter/UserPainter.js'),\n\tfunctions = require('../common/utils/functions'),\n\tdeviceP = require('device');\n\nvar UserController = function() {\n\tthis.init.apply(this, arguments);\n};\n\n_.extend(UserController.prototype, BaseController.prototype , {\n\n\tmodelName: 'User',\n\tworkModel: require(pathModels+'/Work.js').model(),\n\tstarsModel: require(pathModels+'/Stars.js').model(),\n\tclientModel: require(pathModels+'/Client.js').model(),\n\tbhAccountModel: require(pathModels+'/BHAccount.js').model(),\n\tcenterRequestModel: require(pathModels+'/BHCenterRequest.js').model(),\n\tpushTokens: require(pathModels+'/PushToken.js').model(),\n\tpreUserModel: require(pathModels+'/PreUser.js').model(),\n\tUser: require(pathModels +  '/User.js').model(),\n\tUserAgent: require(pathModels + '/UserAgent.js').model(),\n\tShadeEvent: require(pathModels + '/ShadeEvent.js').model(),\n\taffiliatesTrackingModel: require(pathModels+'/AffiliateTracking.js').model(),\n\n\tpainter: null,\n\n\tinit: function(req, res, config) {\n\t\tBaseController.prototype.init.apply(this, arguments);\n\t\tthis.painter = new UserPainter(req, res, config ? config.mode : UserPainter.MODE_HTML);\n\t},\n\n\t_generatePassword : function(strPass) {\n\t\tvar salt = bcrypt.genSaltSync(10);\n\t\treturn bcrypt.hashSync(strPass, salt);\n\t},\n\n\tbookings: function() {\n\t\tvar worksPromise  = new when.Deferred();\n\t\tvar treatmentsPromise = new when.Deferred();\n\t\tvar bhAccountsPromise = new when.Deferred();\n\t\twhen.seq([\n\t\t\tfunction(idUser){\n\t\t\t\treturn this.clientModel.findWithoutBHAccount({ idUser : idUser }).lean().exec();\n\t\t\t}.bind(this),\n\t\t\tfunction(clients) {\n\t\t\t\tthis.bhAccountModel.find({ _id : { $in : _.uniq(_.pluck(clients, '_idBHAccount')) } }, 'name description location address path bc')\n\t\t\t\t\t.lean().exec(function(err, bhAccounts){\n\t\t\t\t\t\tbhAccountsPromise.resolve(_.indexBy(bhAccounts, '_id'));\n\t\t\t\t\t});\n\t\t\t\tthis.workModel.findWithoutBHAccount({ idClient : { $in : _.pluck(clients, '_id') } }, '_id _idBHAccount state day iniHour fiHour idTreatment loyalityCredit loyalityProgram price promoCodes')\n\t\t\t\t\t.sort({ day : -1, iniHour : -1}).exec(function(err, works){\n\t\t\t\t\t\tvar treatmentIds = [];\n\t\t\t\t\t\tworks.forEach(function(work){\n\t\t\t\t\t\t\ttreatmentIds = treatmentIds.concat(work.idTreatment);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.treatmentModel.findWithoutBHAccount({ _id : { $in : _.uniq(treatmentIds) }}, 'name _idBHAccount avgtime category price tax') //OJO que a partir de ahora habra q fijarse en el precio del work. Avisar a movil!\n\t\t\t\t\t\t.lean().exec(function(err, treatments){\n\t\t\t\t\t\t\ttreatmentsPromise.resolve(_.indexBy(treatments, '_id'));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tworksPromise.resolve(works);\n\t\t\t\t\t}.bind(this));\n\t\t\t}.bind(this)\n\t\t], this.req.user._id);\n\t\twhen.all([\n\t\t\tworksPromise,\n\t\t\ttreatmentsPromise,\n\t\t\tbhAccountsPromise\n\t\t]).then(function(results) {\n\t\t\tdata = _.object(['works', 'treatments', 'bhAccounts'], results);\n\t\t\tthis.painter.renderBookings(data);\n\t\t}.bind(this));\n\t},\n\n\tprofile: function(){\n\t\tvar aux = _.pick(this.req.user, '_id', 'name', 'lastname', 'email', 'phone', 'address', 'postcode', 'gender', 'bDay', 'bMonth', 'bYear', 'loyalityCredit');\n\t\taux.creditCards =  [{cardName: 'Jordi Montes Sanabria',cardIdentifier: 'askjajsjdfasd', cardExpiryDate: '12/2016', cardNumber: '459984****12343' },\n\t\t\t{cardName: 'Daniel Balastegui',cardIdentifier: 'askjajsjdfasd', cardExpiryDate: '07/2016', cardNumber: '459984****12546' }];\n\t\tthis.painter.render(null, {\n\t\t\tuser: aux\n\t\t\t//user: _.pick(this.req.user, '_id', 'name', 'lastname', 'email', 'phone', 'address', 'postcode', 'gender', 'bDay', 'bMonth', 'bYear', 'loyalityCredit')\n\t\t});\n\t},\n\n\tlogin: {\n\t\tget: function() {\n\t\t\tthis.painter.renderLogin();\n\t\t}\n\t},\n\n\tloginFacebook: function() {\n\t\tif ( !this.req.body.agent_name || !this.req.body.email ) {\n\t\t\tthis.res.status(400);\n\t\t\tthis.res.send('Bad request: Agent name or email not found');\n\t\t\treturn null;\n\t\t}\n\t\tvar that = this;\n\t\tthat.User.findOne(\n\t\t\t{ $or: [{'facebook' : that.req.body.id }, {'email': that.req.body.email }]},\n\t\t\tfunction( err, user ) {\n\t\t\t\tvar loginPr = when.Deferred();\n\t\t\t\tif ( err ) {\n\t\t\t\t\tthat.res.status(500).send(err);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tif ( user ) {\n\t\t\t\t\tif ( user.facebook ) loginPr.resolve(user);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthat.User.update({ _id: user._id}, {$set: {facebook : that.req.body.id}},\n\t\t\t\t\t\t\tfunction( err ) {\n\t\t\t\t\t\t\t\tif ( err ) {\n\t\t\t\t\t\t\t\t\tthat.res.status(500).send(err);\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tloginPr.resolve(user);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar newUser = new that.User();\n\t\t\t\t\tnewUser.name \t\t= that.req.body.first_name;\n\t\t\t\t\tnewUser.lastname \t= that.req.body.last_name;\n\t\t\t\t\tnewUser.email \t\t= functions.cleanEmail(that.req.body.email);\n\t\t\t\t\tnewUser.gender \t\t= that.req.body.gender;\n\t\t\t\t\tnewUser.facebook \t= that.req.body.id;\n\t\t\t\t\tnewUser.save(function(err) {\n\t\t\t\t\t\tif ( err ) {\n\t\t\t\t\t\t\tthat.res.status(500).send(err);\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloginPr.resolve(newUser);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tloginPr.then(function (results) {\t// results contains user\n\t\t\t\t\tthat.UserAgent.count({ idUser : results.id }, function(err, count ){\n\t\t\t\t\t\tcrypto.randomBytes(48, function(ex, buf) {\n\t\t\t\t\t\t\tvar token = buf.toString('hex');\n\t\t\t\t\t\t\tthat.UserAgent.update(\n\t\t\t\t\t\t\t\t{idUser : results.id, name : that.req.body.agent_name},\n\t\t\t\t\t\t\t\t{$set: { token: crypto.createHash('sha1').update(token).digest('hex') }},\n\t\t\t\t\t\t\t\t{ upsert : true }, function(err){\n\t\t\t\t\t\t\t\t\tif(!err) {\n\t\t\t\t\t\t\t\t\t\t['pushios', 'pushandroid'].forEach(function(key){\n\t\t\t\t\t\t\t\t\t\t\tif (!that.req.body[key]) return;\n\t\t\t\t\t\t\t\t\t\t\tvar arr = results[key] || [];\n\t\t\t\t\t\t\t\t\t\t\tif (arr.indexOf(that.req.body[key]) >= 0) return;\n\t\t\t\t\t\t\t\t\t\t\tarr.push(that.req.body[key]);\n\t\t\t\t\t\t\t\t\t\t\tresults[key] = arr;\n\t\t\t\t\t\t\t\t\t\t\tresults.save();\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tvar basePainter = require('../painter/abstract/BasePainter.js' );\n\t\t\t\t\t\t\t\t\tthat.painter.render(null, {\n\t\t\t\t\t\t\t\t\t\ttoken: token,\n\t\t\t\t\t\t\t\t\t\tlogged: true,\n\t\t\t\t\t\t\t\t\t\tuser: results,\n\t\t\t\t\t\t\t\t\t\tformattedLoyalityCredit: basePainter.prototype.helpers.moneyFormat(results.loyalityCredit || 0)\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tvar agent = that.req.headers['user-agent'] || \"\";\n\t\t\t\t\t\t\t\t\tLogUser.create({\n\t\t\t\t\t\t\t\t\t\tid : results ? results._id : undefined ,\n\t\t\t\t\t\t\t\t\t\tdate: new Date(),\n\t\t\t\t\t\t\t\t\t\tip : ipware.get_ip(that.req).clientIp,\n\t\t\t\t\t\t\t\t\t\tplace : agent.match(/(android)/gi) ? 'p_android' : agent.match(/(iPad|iPhone|iPod)/g) ? 'p_ios' : 'p_web'\n\t\t\t\t\t\t\t\t\t}, function(){});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t},\n\n\tregister: {\n\n\t\tpost: function( callback ) {\n\t\t\tif(this.req.user)\n\t\t\t\treturn this.res.redirect('/');\n\t\t\tvar fieldErrors = {};\n\t\t\tvar showError = function( formError ){\n\t\t\t\tthis.res.status(400);\n\t\t\t\tthis.painter.render(null, { success: false, error: formError, fieldErrors : fieldErrors});\n\t\t\t}.bind(this);\n\t\t\tif ( this.req.body.email )\n\t\t\t\tthis.req.body.email = functions.cleanEmail(this.req.body.email);\n\t\t\tvar data = _.clone(this.req.body);\n\t\t\t['name', 'lastname', 'password', 'email', 'gender', 'phone', 'postcode'].forEach(function(field){\n\t\t\t\tif(!data[field])\n\t\t\t\t\tfieldErrors[field] = 'field_is_mandatory';\n\t\t\t}.bind(this));\n\t\t\tif(Object.keys(fieldErrors).length)\n\t\t\t\treturn showError('check_fields');\n\t\t\tvar that = this;\n\t\t\tthis.model.find({ email: data.email }).lean().exec(function( err , accounts ) {\n\t\t\t\tif( accounts.length ) {\n\t\t\t\t\tfieldErrors.email = 'email_exists';\n\t\t\t\t\treturn showError('email_exists');\n\t\t\t\t}\n\t\t\t\t//Create user\n\t\t\t\tdata.password = this._generatePassword( data.password );\n\t\t\t\tdata.referer  = that.req.session ? that.req.session.referer || undefined : undefined;\n\n\t\t\t\tvar agent = this.req.headers['user-agent'] || \"\";\n\t\t\t\tvar device = deviceP(this.req.headers['user-agent']);\n\t\t\t\tif(device.type == 'phone' || device.type == 'tablet') {\n\t\t\t\t\tif(agent.match(/(android|okhttp)/gi)) device = \"android_\"+device.type;\n\t\t\t\t\telse if(agent.match(/(iPad|iPhone|iPod)/g)) device = \"ios_\"+device.type;\n\t\t\t\t} else device = device.type;\n\n\t\t\t\tvar from = this.req.body.from;\n\t\t\t\tif(!from) {\n\t\t\t\t\tfrom = agent.match(/(android|okhttp)/gi) ? 'p_android' : agent.match(/(iPad|iPhone|iPod)/g) ? 'p_ios' : this.req.body.from;\n\t\t\t\t}\n\t\t\t\tdata.register_data = {\n\t\t\t\t\tip : this.req.headers['x-forwarded-for'] || this.req.connection.remoteAddress,\n\t\t\t\t\tfrom : from,\n\t\t\t\t\tdevice: device\n\t\t\t\t};\n\n\t\t\t\tif(this.req.cookies.tracking) data.tracking =  _.escape(this.req.cookies.tracking.substring(0, 16));\n\n\t\t\t\tthis.affiliatesTrackingModel.userAffiliationCost(this.req.cookies.affiliation, data, function(pixel){\n\t\t\t\t\tthat.model.create( data , function( err , account ) {\n\n\t\t\t\t\t\tif (!err && pixel && data.register_data.from == 'p_web')\n\t\t\t\t\t\t\tthat.req.session.pixel = pixel;\n\n\t\t\t\t\t\tthat.preUserModel.find({email: data.email}, function (err, preuser) {\n\t\t\t\t\t\t\tif (preuser && preuser[0]) {\n\t\t\t\t\t\t\t\tpreuser[0].idUser = account._id;\n\t\t\t\t\t\t\t\tpreuser[0].save();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif(that.req.body.from != 'o_web') {\n\t\t\t\t\t\t\tthat.getModel('BHPollMessage')\n\t\t\t\t\t\t\t\t.create({ idUser: account._id, type:  \"USER_WELCOME\" }, function(){});\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(err, account);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn err ? showError('unknow') : that.painter.render(null, {success: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tget: function() {\n\t\t\tif(this.req.user) {\n\t\t\t\treturn this.res.redirect('/');\n\t\t\t}\n\t\t\tthis.painter.renderRegister();\n\t\t}\n\t},\n\n\tregisterFacebook: {\n\t\tpost: function( callback ) {\n\t\t\tif(this.req.user && !this.req.user.isNew) {\n\t\t\t\treturn this.res.redirect('/');\n\t\t\t}\n\t\t\tvar fieldErrors = {};\n\t\t\tvar showError = function( formError ){\n\t\t\t\tthis.res.status(400);\n\t\t\t\tthis.painter.render(null, { success: false, error: formError, fieldErrors : fieldErrors});\n\t\t\t}.bind(this);\n\t\t\tif ( this.req.body.email )\n\t\t\t\tthis.req.body.email = functions.cleanEmail(this.req.body.email);\n\t\t\tvar data = _.clone(this.req.body);\n\t\t\t['name', 'lastname', 'password', 'email', 'gender', 'phone', 'postcode'].forEach(function(field){\n\t\t\t\tif(!data[field])\n\t\t\t\t\tfieldErrors[field] = 'field_is_mandatory';\n\t\t\t}.bind(this));\n\t\t\tif(Object.keys(fieldErrors).length)\n\t\t\t\treturn showError('check_fields');\n\t\t\tvar that = this;\n\t\t\tthis.model.find({ email: data.email }).lean().exec(function( err , accounts ) {\n\t\t\t\tif( accounts.length ) {\n\t\t\t\t\tfieldErrors.email = 'email_exists';\n\t\t\t\t\treturn showError('email_exists');\n\t\t\t\t}\n\t\t\t\t//Create user\n\t\t\t\tdata.password = this._generatePassword( data.password );\n\t\t\t\tdata.referer  = that.req.session ? that.req.session.referer || undefined : undefined;\n\n\t\t\t\tvar agent = this.req.headers['user-agent'] || \"\";\n\t\t\t\tvar from = this.req.body.from;\n\t\t\t\tif(!from) {\n\t\t\t\t\tfrom = agent.match(/(android|okhttp)/gi) ? 'p_android' : agent.match(/(iPad|iPhone|iPod)/g) ? 'p_ios' : this.req.body.from;\n\t\t\t\t}\n\t\t\t\tdata.register_data = {\n\t\t\t\t\tip : this.req.headers['x-forwarded-for'] || this.req.connection.remoteAddress,\n\t\t\t\t\tfrom : from\n\t\t\t\t};\n\n\t\t\t\tif(this.req.cookies.tracking) data.tracking =  _.escape(this.req.cookies.tracking.substring(0, 16));\n\n\t\t\t\tthis.affiliatesTrackingModel.userAffiliationCost(this.req.cookies.affiliation, data, function(pixel){\n\t\t\t\t\tthat.model.create( data , function( err , account ) {\n\n\t\t\t\t\t\tif (!err && pixel && data.register_data.from == 'p_web')\n\t\t\t\t\t\t\tthat.req.session.pixel = pixel;\n\n\t\t\t\t\t\tthat.preUserModel.find({email: data.email}, function (err, preuser) {\n\t\t\t\t\t\t\tif (preuser && preuser[0]) {\n\t\t\t\t\t\t\t\tpreuser[0].idUser = account._id;\n\t\t\t\t\t\t\t\tpreuser[0].save();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif(that.req.body.from != 'o_web') {\n\t\t\t\t\t\t\tthat.getModel('BHPollMessage')\n\t\t\t\t\t\t\t\t.create({ idUser: account._id, type:  \"USER_WELCOME\" }, function(){});\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\tcallback(err, account);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn err ? showError('unknow') : that.painter.render(null, {success: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tget: function() {\n\t\t\tif(this.req.user && !this.req.user.isNew) {\n\t\t\t\treturn this.res.redirect('/');\n\t\t\t}\n\t\t\tthis.painter.renderRegisterFacebook();\n\t\t}\n\t},\n\n\tregisterSuccess: {\n\t\tget: function() {\n\t\t\tvar pixel = this.req.session.pixel;\n\t\t\tthis.req.session.pixel = '';\n\t\t\tthis.painter.renderRegisterSuccess({ pixel : pixel});\n\n\t\t}\n\t},\n\n\t_generateRecoverPassHash : function ( password ) {\n\t\treturn crypto.createHash('sha1').update([password, new Date().toDateString()].join()).digest('hex');\n\t},\n\n\trecoverPass: {\n\n\t\tpost: function() {\n\t\t\tif(this.req.user)\n\t\t\t\treturn this.res.redirect('/');\n\t\t\tthis.res.json({ success : true });//En un principio enviamos siempre que va bien\n\t\t\tthis.model.findOne({email: functions.cleanEmail(this.req.body['email'])}, function(err, user){\n\t\t\t\tif(user){\n\t\t\t\t\tuser.recoverpass_hash = this._generateRecoverPassHash(user.password);\n\t\t\t\t\tuser.save(function(){\n\t\t\t\t\t\tvar mPollMessage = new Mapper({ noBHAccount: true }).loadModel('BHPollMessage');\n\t\t\t\t\t\tmPollMessage.create([{\n\t\t\t\t\t\t\tidUser \t: user._id,\n\t\t\t\t\t\t\ttype \t: \"USER_PASSWORD_RECOVER\",\n\t\t\t\t\t\t\tjson:{\n\t\t\t\t\t\t\t\tlink\t: \"https://bellahora.com/es/user/set_password/\" + user.recoverpass_hash,\n\t\t\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\t\t\temail:user.email\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}], function(){});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tget: function( ) {\n\t\t\tif(this.req.user)\n\t\t\t\treturn this.res.redirect('/');\n\t\t\tthis.painter.renderRecoverPass();\n\t\t}\n\t},\n\n\tsetPassword: {\n\n\t\tpost : function (){\n\t\t\tif(this.req.user)\n\t\t\t\treturn this.res.redirect('/');\n\t\t\tthis.model.findOne({recoverpass_hash: this.req.params['recoverpass_hash']}, function(err, user){\n\t\t\t\tif(!user)\n\t\t\t\t\treturn this.res.redirect('/user/recoverpass');\n\t\t\t\tvar expectedHash = this._generateRecoverPassHash(user.password);\n\t\t\t\tif(expectedHash != this.req.params['recoverpass_hash']) //El hash es valido solo el mismo dia\n\t\t\t\t\treturn this.res.redirect('/user/recoverpass');\n\t\t\t\tif(!this.req.body['password1'])\n\t\t\t\t\treturn this.res.json({ success : false, error:'password_required' });\n\t\t\t\tif(this.req.body['password1'] != this.req.body['password2'])\n\t\t\t\t\treturn this.res.json({ success : false, error:'password_mismatch' });\n\t\t\t\tuser.password = this._generatePassword( this.req.body['password1'] );\n\t\t\t\tuser.recoverpass_hash = null;\n\t\t\t\tuser.save(function(){\n\t\t\t\t\treturn this.res.json({ success : true});\n\t\t\t\t}.bind(this));\n\t\t\t}.bind(this));\n\t\t},\n\n\t\tget : function (){\n\t\t\tif(this.req.user)\n\t\t\t\treturn this.res.redirect('/');\n\t\t\tthis.model.findOne({recoverpass_hash: this.req.params['recoverpass_hash']}, function(err, user){\n\t\t\t\tif(!user)\n\t\t\t\t\treturn this.res.redirect('/user/recoverpass');\n\t\t\t\tvar expectedHash = this._generateRecoverPassHash(user.password);\n\t\t\t\tif(expectedHash != this.req.params['recoverpass_hash']) //El hash es valido solo el mismo dia\n\t\t\t\t\treturn this.res.redirect('/user/recoverpass');\n\t\t\t\tthis.painter.renderSetPassword();\n\t\t\t}.bind(this));\n\t\t}\n\n\t},\n\n\n\trequestToken: function() {\n\t\tif(!this.req.body.agent_name){\n\t\t\tthis.res.status(400);\n\t\t\tthis.res.send('Bad request');\n\t\t\treturn;\n\t\t}\n\t\tthis.UserAgent.count({ idUser : this.req.user.id }, function(err, count ){\n\t\t\tcrypto.randomBytes(48, function(ex, buf) {\n\t\t\t\tvar token = buf.toString('hex');\n\t\t\t\tthis.UserAgent.update({idUser : this.req.user.id, name : this.req.body.agent_name},\n\t\t\t\t\t{$set: { token: crypto.createHash('sha1').update(token).digest('hex') }},\n\t\t\t\t\t{ upsert : true }, function(err){\n\t\t\t\t\t\tif(!err) {\n\t\t\t\t\t\t\t['pushios', 'pushandroid'].forEach(function(key){\n\t\t\t\t\t\t\t\tif (!this.req.body[key]) return;\n\t\t\t\t\t\t\t\tvar arr = this.req.user[key] || [];\n\t\t\t\t\t\t\t\tif (arr.indexOf(this.req.body[key]) >= 0) return;\n\t\t\t\t\t\t\t\tarr.push(this.req.body[key]);\n\t\t\t\t\t\t\t\tthis.req.user[key] = arr;\n\t\t\t\t\t\t\t\tthis.req.user.save();\n\t\t\t\t\t\t\t}.bind(this));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.painter.render(null, {\n\t\t\t\t\t\t\ttoken: token,\n\t\t\t\t\t\t\tuser: this.req.user\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif(!err && !count){ //Es luser nuevo\n\t\t\t\t\t\t\tthis.User.findOne({_id: this.req.user.id }).exec(function(err, user){\n\t\t\t\t\t\t\t\tif(!user.loyalityCredit)\n\t\t\t\t\t\t\t\t\tuser.loyalityCredit = 0;\n\t\t\t\t\t\t\t\tuser.loyalityCredit += 7; //Le damos 7 ecus\n\t\t\t\t\t\t\t\tuser.save();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar agent = this.req.headers['user-agent'] || \"\";\n\t\t\t\t\t\tLogUser.create({\n\t\t\t\t\t\t\tid : this.req.user ? this.req.user._id : undefined ,\n\t\t\t\t\t\t\tdate: new Date(),\n\t\t\t\t\t\t\tip : ipware.get_ip(this.req).clientIp,\n\t\t\t\t\t\t\tplace: this.req.body.pushandroid ? 'p_android' :\n\t\t\t\t\t\t\t\t  (this.req.body.pushios ? 'p_ios' : 'p_web')\n\t\t\t\t\t\t}, function(){});\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t},\n\n\tbusinessRequestSuccess: {\n\t\tget: function() {\n\t\t\tthis.painter.businessRequestSuccess();\n\t\t}\n\t},\n\tcheckCenterRequest: function(){\n\t\tvar that = this;\n\t\tvar user = this.req.session && this.req.session.passport ? (this.req.session.passport.user||'') : '';\n\t\tvar userIP = ipware.get_ip(this.req).clientIp;\n\t\tvar isAlreadyRequested = false;\n\t\tvar query = {center:that.req.params.id};\n\t\tif(user) {\n\t\t\tquery.$or = [\n\t\t\t\t{user:user},\n\t\t\t\t{ip:userIP}\n\t\t\t];\n\t\t} else query.ip = userIP;\n\t\tthat.centerRequestModel.findOne(query,function(err,request) {\n\t\t\tif (err) return that.res.send(500);\n\t\t\tif (request) isAlreadyRequested = true;\n\n\t\t\tthat.res.send({\n\t\t\t\talreadyRequested:isAlreadyRequested\n\t\t\t});\n\t\t});\n\t},\n\tcenterRequest: function(){\n\t\tvar that = this;\n\t\tvar user = this.req.session && this.req.session.passport ? (this.req.session.passport.user||'') : '';\n\t\tvar userIP = ipware.get_ip(that.req).clientIp;\n\t\tvar query = {center:that.req.params.id};\n\t\tif(user) {\n\t\t\tquery.$or = [\n\t\t\t\t{user:user},\n\t\t\t\t{ip:userIP}\n\t\t\t];\n\t\t} else query.ip = userIP;\n\t\tthat.centerRequestModel.findOne(query,function(err,request) {\n\t\t\tif (err) return that.res.send(500);\n\t\t\tvar center = {\n\t\t\t\tcenter:that.req.params.id,\n\t\t\t\tip:userIP\n\t\t\t};\n\t\t\tif(user) center.user = user;\n\t\t\tthat.centerRequestModel.create(center,function(err,request) {\n\t\t\t\tif (err) that.res.send(500);\n\t\t\t\tthat.res.send(200);\n\t\t\t});\n\t\t});\n\t},\n\n\tunsubscribe: function( email ) {\n\t\tvar that = this;\n\n\t\tvar promises = [];\n\n\t\tpromises.push(that.model.findOne( { email: email } ).exec() );\n\t\tpromises.push(that.preUserModel.findOne( { email: email } ).exec() );\n\n\t\twhen.all(promises).then(function(arr){\n\t\t\tsubPromises = []\n\n\t\t\tif (arr[0]) subPromises.push(that.model.update( { email: email }, {$set: {isUnsubscribed: true}} ).exec());\n\t\t\tif (arr[1]) subPromises.push(that.preUserModel.update( { email: email }, {$set: {isUnsubscribed: true}} ).exec());\n\n\t\t\twhen.all(subPromises).then(function(res){\n\t\t\t\tvar ok = true;\n\t\t\t\tfor (var i = 0; i < res.length;++i) {\n\t\t\t\t\tif (res[i] < 1) ok = false;\n\t\t\t\t}\n\t\t\t\tif (ok) {\n\t\t\t\t\tthat.painter.renderMessage( \"Suscripción anulada\" , \"Ya no recibirá más e-mails, disculpe las molestias.\" );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthat.painter.renderMessage( \"Error\" , \"No se ha podido dar de baja, ha ocurrido un error. Contacte con nosotros en contacta@bellahora.com. Disculpe las molestias.\" );\n\t\t\t\t}\n\t\t\t})\n\n\n\n\t\t});\n\t},\n\n\taddPushToken: function(){\n\t\tvar that = this;\n\t\tvar type,\n\t\t\ttoken,\n\t\t\tlat,\n\t\t\tlon,\n\t\t\tpromises = [];\n\n\t\t['pushios', 'pushandroid'].forEach(function(key){\n\t\t\tif (!that.req.body[key]) return;\n\t\t\ttype = key;\n\t\t\ttoken = that.req.body[key];\n\t\t\tlat = that.req.body['lat'] || null;\n\t\t\tlon = that.req.body['lon'] || null;\n\t\t});\n\n\t\tif(!token) return that.res.send(400);\n\n\t\tvar query = {activated: \"true\"};\n\t\t//si nos han pasado longitud y latitud\n\t\tif (lat && lon) {\n\t\t\tquery.$addToSet =  {geo: {type: 'Point', coordinates:[lon,lat]}};\n\t\t}\n\n\t\tpromises.push(that.pushTokens.update(\n\t\t\t{token:token, type: type},\n\t\t\tquery,\n\t\t\t{upsert:true})\n\t\t.exec());\n\t\tpromises.push(that.User.findOne(\n\t\t\t{ $or: [{ pushios: token}, {pushandroid: token}] } )\n\t\t.exec());\n\n\t\twhen.all(promises).then(\n\t\t\tfunction(arr) {\n\t\t\t\tif (arr[0] && arr[1]) {\t//Found user\n\t\t\t\t\tthat.ShadeEvent.create({\n\t\t\t\t\t\tid : arr[1]._id,\n\t\t\t\t\t\tname: 'login-app',\n\t\t\t\t\t\tdata : {\n\t\t\t\t\t\t\tfrom: that.req.body.pushios ? 'p_ios' :\n\t\t\t\t\t\t\t\t(that.req.body.pushandroid ? 'p_android' : 'p_web')\n\t\t\t\t\t\t}\n\t\t\t\t\t}, function() {});\n\t\t\t\t}\n\t\t\t\tthat.res.send(200);\n\t\t\t},\n\t\t\tfunction(err) {\n\t\t\t\tif(err.code == 11000) return that.res.send(422);\n\t\t\t\tlogger.log(err);\n\t\t\t\treturn that.res.send(500);\n\t\t\t});\n\t},\n\tremovePushToken: function(){\n\t\tvar that = this;\n\t\tvar type,\n\t\t\ttoken;\n\n\t\t['pushios', 'pushandroid'].forEach(function(key){\n\t\t\tif (!that.req.body[key]) return;\n\t\t\ttype = key;\n\t\t\ttoken = that.req.body[key];\n\t\t});\n\n\t\tif(!token) return that.res.send(400);\n\n\t\tthat.pushTokens.update({token:token, type: type},\n\t\t\t{activated: \"false\"}, function(err, token){\n\t\t\t\tif(err) {\n\t\t\t\t\tif(err.code == 11000) return that.res.send(422);\n\t\t\t\t\tlogger.error(err);\n\t\t\t\t\treturn that.res.send(500);\n\t\t\t\t}\n\t\t\t\tthat.res.send(200);\n\t\t\t});\n\t},\n\tremoveUserPushToken: function(){\n\t\tvar that = this;\n\t\tif(!that.req.user) return that.res.status(401);\n\t\tthat.res.send({});\n\t\tthat.model.findOne({ _id: that.req.user._id }, function(err, user){\n\t\t\tif(err || !user) return;\n\t\t\t['pushios', 'pushandroid'].forEach(function(key){\n\t\t\t\tif (!that.req.body[key]) return;\n\t\t\t\tvar arr = user[key] || [];\n\t\t\t\tuser[key] = arr.filter(function(token){\n\t\t\t\t\treturn token != that.req.body[key];\n\t\t\t\t});\n\t\t\t});\n\t\t\tuser.save();\n\t\t\tthat.req.logout();\n\t\t});\n\t},\n\n\taddFavorite: function(centerId) {\n\t\tvar that = this;\n\t\tif(!centerId) return that.res.send(500);\n\t\tthat.model.update({ _id: that.req.user._id }, { $addToSet: { favoriteCenters: centerId } }, function(err) {\n\t\t\tif (err) return that.res.send(500);\n\t\t\tthat.res.send(200);\n\t\t});\n\t},\n\n\tremoveFavorite: function(centerId) {\n\t\tvar that = this;\n\t\tif(!centerId) return that.res.send(500);\n\t\tthat.model.update({ _id: that.req.user._id }, { $pull: { favoriteCenters: centerId } }, function(err) {\n\t\t\tif (err) return that.res.send(500);\n\t\t\tthat.res.send(200);\n\t\t});\n\t},\n\n\tgetFavorites: function() {\n\t\tfunction clone(obj) {\n\t\t\tif (null == obj || \"object\" != typeof obj) return obj;\n\t\t\tvar copy = obj.constructor();\n\t\t\tfor (var attr in obj) {\n\t\t\t\tif (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\n\t\t\t}\n\t\t\treturn copy;\n\t\t}\n\n\t\tvar that = this;\n\t\tthat.model.findOne({ _id: that.req.user._id })\n\t\t\t.populate('favoriteCenters', 'name description location path address loyalityPrograms score scoreCount')\n\t\t\t.exec(function(err, centers) {\n\t\t\t\tif (err) return that.res.send(500);\n\t\t\t\tif(!centers) return that.res.json([]);\n\n\t\t\t\tvar starsPromise = new when.Deferred();\n\t\t\t\tvar relatedCentres = JSON.parse(JSON.stringify(centers.favoriteCenters));\n\n\t\t\t\tvar centreIds = _.pluck(relatedCentres, '_id').map(function(id){ return id.toString(); });\n\n\t\t\t\tthat.starsModel.Model.aggregate([\n\t\t\t\t\t{ $match : { _idBHAccount: { '$in': centreIds } } },\n\t\t\t\t\t{ $group : {  _id: \"$_idBHAccount\" , sum : { $sum :\"$score\" }, count: {$sum : 1} } }\n\t\t\t\t], function(err, result){\n\t\t\t\t\tstarsPromise.resolve(_.indexBy(result, '_id'));\n\t\t\t\t});\n\n\t\t\t\twhen.all([\n\t\t\t\t\tthat.getCentreImages(centreIds),\n\t\t\t\t\tstarsPromise\n\t\t\t\t]).then(function(results){\n\t\t\t\t\tresults = _.object(['images', 'stars'], results);\n\t\t\t\t\t_.each(relatedCentres, function(c){\n\t\t\t\t\t\tc['images'] = results.images[c._id];\n\t\t\t\t\t\tc['ratings'] = c.scoreCount;\n\t\t\t\t\t\tc['stars'] = c.score;\n\t\t\t\t\t});\n\n\t\t\t\t\tthat.res.json(relatedCentres);\n\t\t\t\t});\n\t\t\t});\n\t},\n\tcheckLoyalityCredit: function(){\n\t\tvar that = this,\n\t\t\tcredits = that.req.user.loyalityCredit || 0,\n\t\t\tvaluePerCredit = 1,\n\t\t\tcanApply = false,\n\t\t\tdiscount = 0,\n\t\t\tmsg;\n\n\t\tif(credits == 0) msg = \"¡No tienes puntos aún!\";\n\t\telse if(credits.toString() < 4) msg = \"Aún no tienes puntos suficientes, necesitas 1000 o 2000 puntos\";\n\t\telse if(credits >= 2000) {\n\t\t\tdiscount = 25;\n\t\t\tmsg = \"¡Tienes 25€ de descuento! Solo podrás gastarlos otra vez cuando llegues a 1000 o 2000 puntos.\";\n\t\t\tcanApply = true;\n\t\t}\n\t\telse if(credits >= 1000) {\n\t\t\tmsg = \"¡Tienes 10€ de descuento! Recuerda que si llegas a 2000 tendrás 25€\";\n\t\t\tdiscount = 10;\n\t\t}\n\n\t\tif(discount > 0){ canApply = true;}\n\n\t\tthat.res.json({\n\t\t\tpoints: credits || 0,\n\t\t\tpointValue:valuePerCredit,\n\t\t\tdiscount: discount,\n\t\t\tmsg:msg,\n\t\t\tcanApply: canApply\n\t\t});\n\t}\n\n});\n\nmodule.exports = UserController;\n","markerStore":{"nextMarkerId":104,"markersById":{"0":{"range":{"start":{"row":1,"column":23},"end":{"row":1,"column":23}},"properties":{"type":"selection","editorId":20,"goalScreenRange":null,"preserveFolds":true},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"2":{"range":{"start":{"row":361,"column":73},"end":{"row":361,"column":74}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"3":{"range":{"start":{"row":392,"column":65},"end":{"row":392,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"4":{"range":{"start":{"row":396,"column":50},"end":{"row":396,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"5":{"range":{"start":{"row":398,"column":33},"end":{"row":398,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"6":{"range":{"start":{"row":400,"column":32},"end":{"row":400,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"7":{"range":{"start":{"row":400,"column":62},"end":{"row":400,"column":63}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"8":{"range":{"start":{"row":402,"column":69},"end":{"row":402,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"9":{"range":{"start":{"row":413,"column":65},"end":{"row":413,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"10":{"range":{"start":{"row":417,"column":50},"end":{"row":417,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"11":{"range":{"start":{"row":534,"column":19},"end":{"row":534,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"12":{"range":{"start":{"row":550,"column":5},"end":{"row":550,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"13":{"range":{"start":{"row":569,"column":31},"end":{"row":569,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"14":{"range":{"start":{"row":570,"column":31},"end":{"row":570,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"15":{"range":{"start":{"row":671,"column":21},"end":{"row":671,"column":22}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"16":{"range":{"start":{"row":704,"column":25},"end":{"row":704,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"17":{"range":{"start":{"row":705,"column":25},"end":{"row":705,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"18":{"range":{"start":{"row":706,"column":25},"end":{"row":706,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"19":{"range":{"start":{"row":721,"column":19},"end":{"row":721,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"30":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"32":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"33":{"range":{"start":{"row":1,"column":26},"end":{"row":1,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"36":{"range":{"start":{"row":1,"column":25},"end":{"row":1,"column":25}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"39":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"40":{"range":{"start":{"row":361,"column":73},"end":{"row":361,"column":74}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"41":{"range":{"start":{"row":392,"column":65},"end":{"row":392,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"42":{"range":{"start":{"row":396,"column":50},"end":{"row":396,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"43":{"range":{"start":{"row":398,"column":33},"end":{"row":398,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"44":{"range":{"start":{"row":400,"column":32},"end":{"row":400,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"45":{"range":{"start":{"row":400,"column":62},"end":{"row":400,"column":63}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"46":{"range":{"start":{"row":402,"column":69},"end":{"row":402,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"47":{"range":{"start":{"row":413,"column":65},"end":{"row":413,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"48":{"range":{"start":{"row":417,"column":50},"end":{"row":417,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"49":{"range":{"start":{"row":534,"column":19},"end":{"row":534,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"50":{"range":{"start":{"row":550,"column":5},"end":{"row":550,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"51":{"range":{"start":{"row":569,"column":31},"end":{"row":569,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"52":{"range":{"start":{"row":570,"column":31},"end":{"row":570,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"53":{"range":{"start":{"row":671,"column":21},"end":{"row":671,"column":22}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"54":{"range":{"start":{"row":704,"column":25},"end":{"row":704,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"55":{"range":{"start":{"row":705,"column":25},"end":{"row":705,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"56":{"range":{"start":{"row":706,"column":25},"end":{"row":706,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"57":{"range":{"start":{"row":721,"column":19},"end":{"row":721,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"60":{"range":{"start":{"row":1,"column":24},"end":{"row":1,"column":24}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"62":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":{"start":{"row":361,"column":73},"end":{"row":361,"column":74}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"64":{"range":{"start":{"row":392,"column":65},"end":{"row":392,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"65":{"range":{"start":{"row":396,"column":50},"end":{"row":396,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"66":{"range":{"start":{"row":398,"column":33},"end":{"row":398,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"67":{"range":{"start":{"row":400,"column":32},"end":{"row":400,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"68":{"range":{"start":{"row":400,"column":62},"end":{"row":400,"column":63}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"69":{"range":{"start":{"row":402,"column":69},"end":{"row":402,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"70":{"range":{"start":{"row":413,"column":65},"end":{"row":413,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"71":{"range":{"start":{"row":417,"column":50},"end":{"row":417,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"72":{"range":{"start":{"row":534,"column":19},"end":{"row":534,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"73":{"range":{"start":{"row":550,"column":5},"end":{"row":550,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"74":{"range":{"start":{"row":569,"column":31},"end":{"row":569,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"75":{"range":{"start":{"row":570,"column":31},"end":{"row":570,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"76":{"range":{"start":{"row":671,"column":21},"end":{"row":671,"column":22}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"77":{"range":{"start":{"row":704,"column":25},"end":{"row":704,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"78":{"range":{"start":{"row":705,"column":25},"end":{"row":705,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"79":{"range":{"start":{"row":706,"column":25},"end":{"row":706,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"80":{"range":{"start":{"row":721,"column":19},"end":{"row":721,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"85":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"86":{"range":{"start":{"row":361,"column":73},"end":{"row":361,"column":74}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"87":{"range":{"start":{"row":392,"column":65},"end":{"row":392,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"88":{"range":{"start":{"row":396,"column":50},"end":{"row":396,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"89":{"range":{"start":{"row":398,"column":33},"end":{"row":398,"column":34}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"90":{"range":{"start":{"row":400,"column":32},"end":{"row":400,"column":33}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"91":{"range":{"start":{"row":400,"column":62},"end":{"row":400,"column":63}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"92":{"range":{"start":{"row":402,"column":69},"end":{"row":402,"column":70}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"93":{"range":{"start":{"row":413,"column":65},"end":{"row":413,"column":66}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"94":{"range":{"start":{"row":417,"column":50},"end":{"row":417,"column":51}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"95":{"range":{"start":{"row":534,"column":19},"end":{"row":534,"column":19}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"96":{"range":{"start":{"row":550,"column":5},"end":{"row":550,"column":5}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"97":{"range":{"start":{"row":569,"column":31},"end":{"row":569,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"98":{"range":{"start":{"row":570,"column":31},"end":{"row":570,"column":32}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"99":{"range":{"start":{"row":671,"column":21},"end":{"row":671,"column":22}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"100":{"range":{"start":{"row":704,"column":25},"end":{"row":704,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"101":{"range":{"start":{"row":705,"column":25},"end":{"row":705,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"102":{"range":{"start":{"row":706,"column":25},"end":{"row":706,"column":26}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true},"103":{"range":{"start":{"row":721,"column":19},"end":{"row":721,"column":20}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"inside","maintainHistory":true}},"version":2},"history":{"version":2,"nextCheckpointId":9,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/home/bellahora-04/Downloads/portal/controller/UserController.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"1370afa73b6a21cd52ddcd8954429024d2c784c9","deserializer":"TextBuffer","version":2},{"text":"// 'use strict';\n// var _ = require('lodash'),\n//   async = require('async'),\n//   when = require('promised-io/promise'),\n//   DateUtils = require('date-utils'),\n//   mongoose = require('mongoose'),\n//   debug = require('debug')('utils'),\n//   moment = require('moment'),\n//   crypto = require('crypto'),\n//   randomstring = require('randomstring'),\n//   Curl = require('node-curl'),\n//   xml2js = require('xml2js'),\n//   validate = require('validate.js'),\n//\n//   projectPath = '../../../',\n//   modelsPath = projectPath + 'common/model/',\n//\n//   config = require(projectPath + 'config.js'),\n//   logger = require(projectPath + 'common/utils/logentries')(),\n//\n//   modelBHA = require(modelsPath + 'BHAccount.js').model(),\n//   modelBHAS = require(modelsPath + 'BHAccountSubscription.js').model(),\n//   modelBHB = require(modelsPath + 'BHBill.js').model(),\n//   modelC = require(modelsPath + 'Country.js').model(),\n//   modelCC = require(modelsPath + 'CreditCard.js').model();\n//\n//\n// /****\n//  Las bills tienen distintos estados\n//  -1 bill acabada de generar\n//  -5 bill pendiente de pago\n//  -3 bill pagada por nose donde pero esta bien cobrada (esto se mejorara en breves... o no)\n//  -6 bill en la cual hay que mirar que nos responido redsys (no sabemos si se cobro o no)\n//  -7 bill creada con el importe de 0 euros           <--- estas bills dan problemas hay que tenerlo en cuenta\n//  -8 bill creada pero usuario sin tarjeta de credito <--- estas bills dan problemas hay que tenerlo en cuenta\n//\n//  0 <= bill < 100 Si las bill tienen este stado es que el pago a sido realizado con exito\n//  100 <= bill Errores varios de redsys, la bill no se ha cobrado\n//\n//  Todas las bills deben tener number bill\n//  si no se cobraron se pone -1\n//  si se cobraron se pone un numero (el siguiente en la serie)\n//\n//  Se recomienda cuando se pone un estado decisivo en la bill (state) que se acutalizen las BHA y BHAS\n//  Y se deje para otro proceso el tema de numeracion. (A poder solo uno en todo el sistema)\n//  ****/\n//\n//\n// var getCurrencySymbol = function (value) {\n//   return value === 'EUR' ? '€' : '$'\n// };\n//\n// //Bill charges\n// var premiumCharge = function (bill, bha, bhas) {\n//   var symbol = getCurrencySymbol(bill.currency);\n//   if (bhas.nextPayDate.isBefore(Date.tomorrow()))\n//     bill.charges.push({\n//       //{ concept : \"Premium Bellahora: \" + bhas.pricePremium + \" \" + cashSymbol,  price : bhas.pricePremium\n//       concept: \"Premium Bellahora: \" + bhas.pricePremium.toFixed(2) + symbol, price: bhas.pricePremium\n//     });\n// };\n//\n// var smsCharge = function (bill, bha, bhas) {\n//   if (bha.smsToPay > 0) {\n//     var symbol = getCurrencySymbol(bill.currency);\n//     var totalPrice = bha.smsToPay * bhas.priceSms;\n//     bill.charges.push({\n//       concept: bha.smsToPay + \" sms * \" + bhas.priceSms.toFixed(2) + symbol + '/sms :' + totalPrice.toFixed(2),\n//       price: totalPrice\n//     });\n//   }\n// };\n//\n// var extraCharge = function (bill, bhas) {\n//   _.each(bhas.extraCharges, function (charge) {\n//     bill.charges.push({\n//       concept: bhas.extraCharges.concept, price: bhas.extraCharges.price\n//     });\n//   });\n// };\n//\n// var taxesCharge = function (bill, bha, country) {\n//   if (bha.country === 'es' && bha.taxtype === 'IVA') {\n//     bill.taxes.push({\n//       name: \"IVA\", value: country.tval[0]\n//     });\n//   }\n// };\n//\n//\n// var getRelevantBillInfo = function (id) {\n//   var promise = new when.Deferred();\n//   var promises = [];\n//\n//   promises.push(modelBHA.find({_id: id}).exec());\n//   promises.push(modelBHAS.findWithoutBHAccount({_idBHAccount: id}).exec());\n//   when.all(promises).then(function (results) {\n//     var bha = results[0][0];\n//     var bhas = results[1][0];\n//     modelC.findOne({idKey: bha.country}).exec(function (err, country) {\n//       promise.resolve([bha, bhas, country]);\n//     });\n//   });\n//   return promise.promise;\n// };\n//\n// var getOrder = function () {\n//   var date = new Date();\n//   var day = moment(date).format('DD');\n//   var month = moment(date).format('MM');\n//   var year = moment(date).format('YY');\n//   return day + month + year + randomstring.generate(6);\n// };\n//\n//\n// var generateBillBuySMS = function(id, numSMS) {\n//   var promise = new when.Deferred();\n//   var bill = {};\n//\n//   //Generate base bill\n//   bill._idBHAccount = id;\n//   bill.charges = [];\n//   bill.taxes = [];\n//   bill.date = new Date();\n//   bill.order = getOrder();\n//   bill.state = -5;\n//\n//   //Get relevant information\n//   getRelevantBillInfo(id).then(function (res) {\n//     var bha = res[0];\n//     var bhas = res[1];\n//     var country = res[2];\n//\n//     var cashSymbol;\n//     if (country)\n//       cashSymbol = (country.psymbol || country.csymbol);\n//     else if (bha.taxcurrency)\n//       cashSymbol = bha.taxcurrency;\n//\n//     if (!cashSymbol)\n//       cashSymbol = '€';\n//\n//     bill.currency = cashSymbol === '€' ? 'EUR' : 'USD';\n//\n//     //Charge bill\n//     var priceSMS;\n//     if (numSMS == 300) {\n//       priceSMS = 0.11;\n//     } else if (numSMS == 600) {\n//       priceSMS = 0.10;\n//     } else if (numSMS == 1000) {\n//       priceSMS = 0.08;\n//     } else {\n//       promise.resolve();\n//       return;\n//     }\n//\n//     var totalPrice = numSMS * priceSMS;\n//\n//     bill.charges.push({\n//       concept: numSMS + \" sms * \" + priceSMS + cashSymbol + '/sms : ' + totalPrice.toFixed(2),\n//       price: totalPrice\n//     });\n//\n//     taxesCharge(bill, bha, country);\n//\n//     //Saving Bill\n//     //debug('Estaria generando esta bill', bill);\n//     modelBHB.idBHAccount = id;\n//     modelBHB.create(bill, function (err, bill) {\n//       if (err) console.log(err);\n//       promise.resolve(bill._id);\n//     });\n//   });\n//\n//   return promise.promise;\n// }\n//\n// var generateBill = function (id) {\n//   var promise = new when.Deferred();\n//   var bill = {};\n//\n//   //Generate base bill\n//   bill._idBHAccount = id;\n//   bill.charges = [];\n//   bill.taxes = [];\n//   bill.date = new Date();\n//   bill.order = getOrder();\n//   bill.state = -5;\n//\n//   //Get relevant information\n//   getRelevantBillInfo(id).then(function (res) {\n//     var bha = res[0];\n//     var bhas = res[1];\n//     var country = res[2];\n//\n//     var cashSymbol;\n//     if (country)\n//       cashSymbol = (country.psymbol || country.csymbol);\n//     else if (bha.taxcurrency)\n//       cashSymbol = bha.taxcurrency;\n//\n//     if (!cashSymbol)\n//       cashSymbol = '€';\n//\n//     bill.currency = cashSymbol === '€' ? 'EUR' : 'USD';\n//\n//     //Charge bill\n//     premiumCharge(bill, bha, bhas);\n//     smsCharge(bill, bha, bhas);\n//     extraCharge(bill, bhas);\n//     taxesCharge(bill, bha, country);\n//\n//     //Saving Bill\n//     //debug('Estaria generando esta bill', bill);\n//     modelBHB.idBHAccount = id;\n//     modelBHB.create(bill, function (err, bill) {\n//       if (err) console.log(err);\n//       //debug('Esta es la bill que he guadado', bill);\n//       promise.resolve(bill._id);\n//     });\n//   });\n//\n//   return promise.promise;\n// };\n//\n//\n// // Recibe un objeto bill con: amount, order, currency\n// // Recibe un objeto cc con: identifier\n//\n// var redsysComunication = function (bill, cc) {\n//   var promise = new when.Deferred();\n//   //Check if amount is 0 (error in redsys)\n//   if (bill.amount <= 0) {\n//     logger.log('Se esta intentado producir un pago de 0 euros', bill);\n//     promise.resolve(-7);\n//     return promise.promise;\n//   }\n//\n//   var DS_MERCHANT_AMOUNT = parseInt(bill.amount * 100),\n//     DS_MERCHANT_ORDER = bill.order,\n//     DS_MERCHANT_MERCHANTCODE = '223236373',\n//     DS_MERCHANT_CURRENCY = bill.currency === 'EUR' ? '978' : '840',\n//     DS_MERCHANT_TRANSACTIONTYPE = 'A',\n//     DS_MERCHANT_IDENTIFIER = cc.identifier,\n//     DS_MERCHANT_DIRECTPAYMENT = true,\n//     paymentKey = 'de9d5f3be97e0871f3e4',\n//\n//     DS_MERCHANT_TERMINAL = bill.currency === 'USD' ? '3' : '2',\n//     DS_Version = '1.0';\n//\n//   var shasum = crypto.createHash('sha1');\n//   shasum.update(\n//     DS_MERCHANT_AMOUNT +\n//     DS_MERCHANT_ORDER +\n//     DS_MERCHANT_MERCHANTCODE +\n//     DS_MERCHANT_CURRENCY +\n//     DS_MERCHANT_TRANSACTIONTYPE +\n//     DS_MERCHANT_IDENTIFIER +\n//     DS_MERCHANT_DIRECTPAYMENT +\n//     paymentKey\n//   );\n//\n//   var DS_MERCHANT_MERCHANTSIGNATURE = shasum.digest('hex');\n//\n//   var data =\n//     'entrada=' +\n//     '<DATOSENTRADA>' +\n//     '<DS_Version>1.0</DS_Version>' +\n//     '<DS_MERCHANT_AMOUNT>' + DS_MERCHANT_AMOUNT + '</DS_MERCHANT_AMOUNT>' +\n//     '<DS_MERCHANT_CURRENCY>' + DS_MERCHANT_CURRENCY + '</DS_MERCHANT_CURRENCY>' +\n//     '<DS_MERCHANT_ORDER>' + DS_MERCHANT_ORDER + '</DS_MERCHANT_ORDER>' +\n//     '<DS_MERCHANT_MERCHANTCODE>' + DS_MERCHANT_MERCHANTCODE + '</DS_MERCHANT_MERCHANTCODE>' +\n//     '<DS_MERCHANT_MERCHANTSIGNATURE>' + DS_MERCHANT_MERCHANTSIGNATURE + '</DS_MERCHANT_MERCHANTSIGNATURE>' +\n//     '<DS_MERCHANT_TERMINAL>' + DS_MERCHANT_TERMINAL + '</DS_MERCHANT_TERMINAL>' +\n//     '<DS_MERCHANT_TRANSACTIONTYPE>' + DS_MERCHANT_TRANSACTIONTYPE + '</DS_MERCHANT_TRANSACTIONTYPE>' +\n//     '<DS_MERCHANT_MERCHANTDATA>Cobro bellahora</DS_MERCHANT_MERCHANTDATA>' +\n//     '<DS_MERCHANT_IDENTIFIER>' + DS_MERCHANT_IDENTIFIER + '</DS_MERCHANT_IDENTIFIER>' +\n//     '<DS_MERCHANT_DIRECTPAYMENT>true</DS_MERCHANT_DIRECTPAYMENT>' +\n//     '</DATOSENTRADA>';\n//\n//   if (config.environment === 'production') {\n//     var curl = Curl.create();\n//     curl('https://sis.redsys.es/sis/operaciones', {\n//       'HEADER': 0,\n//       'POST': 1,\n//       'SSL_CIPHER_LIST': \"AES256-SHA\",\n//       'POSTFIELDS': data\n//     }, function (err) {\n//       logger.log('Datos Relativos al pago',\n//         \"----------TPV ANSWER----------\",\n//         \"status\",\n//         this.status,\n//         '-----',\n//         \"body\",\n//         this.body,\n//         '-----'\n//       );\n//\n//       if (this.status != 200) {\n//         promise.resolve(-6);\n//       } else {\n//         var response = this.body;\n//         xml2js.parseString(response, function (err, res) {\n//           if (parseInt(res.RETORNOXML.CODIGO[0], 10) !== 0) {\n//             logger.log('Redsys no ha retornado lo que esperabamos, esta es la bill:', bill, 'Esto es el xml: ', response);\n//             promise.resolve(-6);\n//           }\n//           else {\n//             var code = res.RETORNOXML.OPERACION[0].Ds_Response[0];\n//             logger.log('Redsys response: ', bill, response);\n//             promise.resolve(code);\n//           }\n//         });\n//       }\n//     });\n//   }\n//   else {\n//     var code = Math.random() > 0.7 ? 0 : 190;\n//     promise.resolve(code);\n//   }\n//   return promise.promise;\n// };\n//\n//\n// var clickToPayComunication = function (bill, cc) {\n//   var promise = new when.Deferred();\n//\n//   var DS_Version = '1.0',\n//     DS_MERCHANT_AMOUNT = parseInt(bill.amount * 100),\n//     DS_MERCHANT_CURRENCY = bill.currency === 'EUR' ? '978' : '840',\n//     DS_MERCHANT_TRANSACTIONTYPE = '0',\n//     DS_MERCHANT_TERMINAL = bill.currency === 'USD' ? '3' : '2',\n//     DS_MERCHANT_MERCHANTCODE = '223236373',\n//     DS_MERCHANT_ORDER = bill.order,\n//     DS_MERCHANT_PAN = cc.cardNumber,\n//     DS_MERCHANT_EXPIRYDATE = cc.year + cc.month,\n//     DS_MERCHANT_IDENTIFIER = 'REQUIRED',\n//     DS_MERCHANT_CVV2 = cc.cardCVC,\n//     paymentKey = 'de9d5f3be97e0871f3e4';\n//\n//   var shasum = crypto.createHash('sha1');\n//   shasum.update(\n//     DS_MERCHANT_AMOUNT +\n//     DS_MERCHANT_ORDER +\n//     DS_MERCHANT_MERCHANTCODE +\n//     DS_MERCHANT_CURRENCY +\n//     DS_MERCHANT_PAN +\n//     DS_MERCHANT_CVV2 +\n//     DS_MERCHANT_TRANSACTIONTYPE +\n//     DS_MERCHANT_IDENTIFIER +\n//     paymentKey\n//   );\n//\n//   var DS_MERCHANT_MERCHANTSIGNATURE = shasum.digest('hex');\n//\n//   var data =\n//     'entrada=' +\n//     '<DATOSENTRADA>' +\n//     '<DS_Version>1.0</DS_Version>' +\n//     '<DS_MERCHANT_AMOUNT>' + DS_MERCHANT_AMOUNT + '</DS_MERCHANT_AMOUNT>' +\n//     '<DS_MERCHANT_CURRENCY>' + DS_MERCHANT_CURRENCY + '</DS_MERCHANT_CURRENCY>' +\n//     '<DS_MERCHANT_TRANSACTIONTYPE>' + DS_MERCHANT_TRANSACTIONTYPE + '</DS_MERCHANT_TRANSACTIONTYPE>' +\n//     '<DS_MERCHANT_MERCHANTDATA>Cobro bellahora</DS_MERCHANT_MERCHANTDATA>' +\n//     '<DS_MERCHANT_MERCHANTSIGNATURE>' + DS_MERCHANT_MERCHANTSIGNATURE + '</DS_MERCHANT_MERCHANTSIGNATURE>' +\n//     '<DS_MERCHANT_TERMINAL>' + DS_MERCHANT_TERMINAL + '</DS_MERCHANT_TERMINAL>' +\n//     '<DS_MERCHANT_MERCHANTCODE>' + DS_MERCHANT_MERCHANTCODE + '</DS_MERCHANT_MERCHANTCODE>' +\n//     '<DS_MERCHANT_ORDER>' + DS_MERCHANT_ORDER + '</DS_MERCHANT_ORDER>' +\n//     '<DS_MERCHANT_PAN>' + DS_MERCHANT_PAN + '</DS_MERCHANT_PAN>' +\n//     '<DS_MERCHANT_CVV2>' + DS_MERCHANT_CVV2 + '</DS_MERCHANT_CVV2>' +\n//     '<DS_MERCHANT_EXPIRYDATE>' + DS_MERCHANT_EXPIRYDATE + '</DS_MERCHANT_EXPIRYDATE>' +\n//     '<DS_MERCHANT_IDENTIFIER>' + DS_MERCHANT_IDENTIFIER + '</DS_MERCHANT_IDENTIFIER>' +\n//     '</DATOSENTRADA>';\n//\n//\n//   if (config.environment === 'production') {\n//     var curl = Curl.create();\n//     curl('https://sis.redsys.es/sis/operaciones', {\n//       'HEADER': 0,\n//       'POST': 1,\n//       'SSL_CIPHER_LIST': \"AES256-SHA\",\n//       'POSTFIELDS': data\n//     }, function (err) {\n//\n//       logger.log('Datos Relativos al pago',\n//         \"----------TPV ANSWER----------\",\n//         \"status\",\n//         this.status,\n//         '-----',\n//         \"body\",\n//         this.body,\n//         '-----'\n//       );\n//\n//       var response = this.body;\n//       xml2js.parseString(response, function (err, res) {\n//         if (parseInt(res.RETORNOXML.CODIGO[0], 10) !== 0) {\n//           logger.log('Redsys no ha retornado lo que esperabamos en click to pay , esta es la bill:', bill,\n//             'Esto es el xml: ', response);\n//           promise.resolve({code: -6});\n//         }\n//         else {\n//           var code = res.RETORNOXML.OPERACION[0].Ds_Response[0];\n//           if (code < 0 || code >= 100) {\n//             promise.resolve({code: code});\n//\n//           } else {\n//             var identifier = res.RETORNOXML.OPERACION[0].Ds_Merchant_Identifier[0];\n//             promise.resolve({code: code, identifier: identifier});\n//           }\n//         }\n//       });\n//     });\n//   }\n//   else {\n//     var code = (Math.random() <= 0.70) ? 0 : 190;\n//     promise.resolve({code: code, identifier: 'Identifierrrrrrrr'});\n//\n//   }\n//   return promise.promise;\n// };\n//\n// var makePayment = function (idBill) {\n//   var promise = new when.Deferred();\n//   modelBHB.findWithoutBHAccount({_id: idBill}).exec(function (err, bills) {\n//     var bill = bills[0];\n//     modelCC.idBHAccount = bill._idBHAccount;\n//     modelCC.findOne({_idBHAccount: bill._idBHAccount}).exec(function (err, cc) {\n//       if (err || !cc) {\n//         logger.log('Error al obtener la tarjeta de credito', bill._idBHAccount, err);\n//         promise.resolve(-8);\n//       } else {\n//         redsysComunication(bill, cc).then(function (code) {\n//           promise.resolve(code);\n//         });\n//       }\n//     });\n//   });\n//   return promise.promise;\n// }\n//\n// var updatePremiumSuccesfull = function (id) {\n//   var promise = new when.Deferred();\n//   getRelevantBillInfo(id).then(function (results) {\n//     var bha = results[0];\n//     var bhas = results[1];\n//\n//     //BHA Things\n//     bha.set('initAction', '');\n//\n//     var interval = bhas.interval === 'month' ? 1 : bhas.interval === 'semestral' ? 6 : 12;\n//\n//     //BHAS Things\n//     bhas.set('state', 'active');\n//     bhas.set('stateCreditCard', 'active');\n//     bhas.set('payed', false);\n//     bhas.set('retryDate', null);\n//     bhas.set('nextPayDate', new Date().add({months: interval}));\n//\n//     bhas.save(function (err) {\n//       if (err) console.log(err);\n//       bha.save(function (err) {\n//         if (err) console.log(err);\n//         promise.resolve();\n//       });\n//     });\n//   });\n//   return promise.promise;\n// };\n//\n// var updatePremiumFailed = function (id) {\n//   var promise = new when.Deferred();\n//   getRelevantBillInfo(id).then(function (results) {\n//     var bha = results[0];\n//     var bhas = results[1];\n//\n//     if (bhas.state === 'semiblocked') {\n//       if (!bhas.retryDate)\n//         bhas.set(\"retryDate\", new Date().add({days: 7}));\n//       if (bhas.retryDate.clone().clearTime() <= new Date().clearTime()) {\n//         bha.set(\"initAction\", \"blockedDialog\");\n//\n//         bhas.set(\"state\", \"blocked\");\n//         bhas.set('payed', false);\n//         bhas.set('nextPayDate', null);\n//         bhas.set('retryDate', null);\n//       }\n//       else\n//         bhas.failedPays.push(new Date());\n//     }\n//     else {\n//       bha.set(\"initAction\", \"debtDialog\");\n//\n//       bhas.set(\"state\", \"semiblocked\");\n//       bhas.set(\"retryDate\", new Date().add({days: 7}));\n//       bhas.failedPays.push(new Date());\n//     }\n//     bhas.save(function (err) {\n//       if (err) console.log(err);\n//       bha.save(function (err) {\n//         if (err) console.log(err);\n//         promise.resolve();\n//       });\n//     });\n//   });\n//   return promise.promise;\n// };\n//\n//\n// var getNextNumberBill = function () {\n//   var promise = new when.Deferred();\n//   modelBHB.findWithoutBHAccount({\n//     numberBill: {\n//       $ne: null\n//     }\n//   }, {\n//     numberBill: 1\n//   }).sort({\n//     numberBill: -1\n//   }).exec(function (err, results) {\n//     if (err) console.log(err);\n//     promise.resolve(parseInt(results[0].numberBill) + 1);\n//   });\n//   return promise.promise;\n// }\n//\n//\n//\n//\n// var activeBHASubscripiton = function (_idBHAccount) {\n//   modelBHAS.findWithoutBHAccount({_idBHAccount: _idBHAccount}, function (err, bhass) {\n//     if(err) return;\n//     if (bhass.length != 1) {\n//       logger.log('Error relacionado con BHAS no tiene o tiene mas de una: ' + _idBHAccount);\n//     } else {\n//       var bhas = bhass[0];\n//       bhas.set(state,'active');\n//       bhas.save(function (err) {\n//         if (err) {\n//           logger.log('Error al guardar la bhas de la bha' + _idBHAccount);\n//         }\n//       });\n//     }\n//   });\n// }\n//\n//\n// //Debe pulirse el rollo del estado -3 que es una puta basura\n// //Estaria bien hacer un refactor de esta funcion y partirla en 2 o 3 (para cada caso que tengmaos)\n// var numerateBills = function () {\n//   var promise = new when.Deferred();\n//   var postToLogentries = function (bill) {\n//     logger.info('BWD bill guardada: \\n' + bill);\n//   };\n//   modelBHB.findWithoutBHAccount({state: -3}).exec(function (err, bills) {\n//     var promises = [];\n//     _.each(bills, function (bill) {\n//       promises.push(updatePremiumSuccesfull(bill._idBHAccount));\n//     });\n//     when.all(promises).then(function () {\n//       getNextNumberBill().then(function (n) {\n//         modelBHB.findWithoutBHAccount({\n//           numberBill: {$exists: false}\n//         }).sort({date: 1}).exec(function (err, bhbs) {\n//           async.eachSeries(bhbs, function (bhb, callback) {\n//\n//             if (bhb.state >= 0 && bhb.amount > 0) {\n//               var number = bhb.state >= 100 ? -1 : n;\n//               if (number === n) ++n;\n//               bhb.set('numberBill', number);\n//               bhb.save(function (err) {\n//                 if (err) console.log(err);\n//                 postToLogentries(bhb);\n//                 callback();\n//               });\n//             } else {\n//               bhb.set('numberBill', -1);\n//               if (bhb.state === -3) {\n//                 bhb.set('numberBill', n);\n//                 bhb.set('state', 2);\n//                 ++n;\n//                 //Actualizamos el estado a activo pk ha pagado y nos ahorramos problemas\n//                 activeBHASubscripiton(bhb._idBHAccount);\n//               }\n//               bhb.save(function (err) {\n//                 if (err) console.log(err);\n//                 postToLogentries(bhb);\n//                 callback();\n//               });\n//             }\n//           }, function done() {\n//             promise.resolve();\n//           });\n//         });\n//       });\n//     });\n//   });\n//   return promise.promise;\n// };\n//\n// //ErrorForHumans\n// var errorToHumans = {\n//   '0101': 'Tarjeta Caducada',\n//   '0102': 'Tarjeta en excepción transitoria o bajo sospecha de fraude',\n//   '0116': 'Disponible Insuficiente',\n//   '0118': 'Tarjeta no Registrada',\n//   '0180': 'Tarjeta ajena al servicio',\n//   '0184': 'Error en la autenticacioón del titular',\n//   '0190': 'Denegación sin especificar motivo',\n//   '0191': 'Fecha de caducidad errónea',\n//   '0202': 'Tarjeta en excepción transitoria o bajo sospecha de fraude con retirada de tarjeta',\n//   '0912': 'Emisor no Disponible',\n//   '0904': 'Comercio no registrado en FUC',\n//   '9064': 'Número de posiciones de la tarjeta incorrecto',\n//   '9078': 'No existe método de pago válido para esa tarjeta',\n//   '9093': 'Tarjeta no existente',\n//   '9218': 'El comercio no permite op. seguras por entrada /operaciones',\n//   '9253': 'Tarjeta no cumple el check-digit',\n//   '9256': 'El comercio no puede realizar preautorizaciones',\n//   '9257': 'Esta tarjeta no permite operativa de preautorizaciones',\n//   '9261': 'Operación detenida por superar el control de restricciones en la entrada al SIS',\n//   '9913': 'Error en la confirmación que el comercio envía al TPV Virtual (solo aplicable en la opción de sincronización SOAP)',\n//   '9914': 'Confirmación “KO” del comercio (solo aplicable en la opción de sincronización SOAP)',\n//   '9928': 'Anulación de autorización en diferido realizada por el SIS (proceso batch)',\n//   '9929': 'Anulación de autorización en diferido realizada por el comercio',\n// }\n//\n//\n// var constraints = {\n//   creditNumber: {\n//     numericality: {\n//       onlyInteger: true,\n//       message: \"^ Solo puede contener números\"\n//     },\n//     presence: {message: \"^El número es obligatorio.\"},\n//     format: {\n//       pattern: /^(34|37|4|5[1-5]).*$/,\n//       message: \"^No es un número válido de Visa o Mastercard.\"\n//     },\n//     length: function (value, attributes, attributeName, options, constraints) {\n//       if (value) {\n//         // Amex\n//         if ((/^(34|37).*$/).test(value)) return {is: 15};\n//         // Visa, Mastercard\n//         if ((/^(4|5[1-5]).*$/).test(value)) return {is: 16};\n//       }\n//       return false;\n//     }\n//   },\n//   creditName: {\n//     presence: {message: \"^El nombre es obligatorio.\"},\n//     format: {\n//       pattern: \"[a-zA-Záéíóúàèìòùñäëüö\\\\s]+\",\n//       flags: \"i\",\n//       message: \"^Solo puede contener letras.\"\n//     }\n//   },\n//   creditCode: {\n//     presence: {message: \"^El código es obligatorio.\"},\n//     length: {\n//       minimum: 3,\n//       message: \"^3 o más carácteres.\"\n//     },\n//     numericality: {\n//       onlyInteger: true,\n//       message: \"^ Solo números.\"\n//     }\n//   }\n// };\n//\n//\n// var checkCreditCard = function (cc) {\n//   var validateNotes = validate(cc, constraints);\n//   if (!validateNotes)\n//     return true;\n//   return true;\n// }\n//\n//\n// module.exports = {\n//   generateBill: generateBill,\n//   generateBillBuySMS: generateBillBuySMS,\n//   getRelevantBillInfo: getRelevantBillInfo,\n//   getOrder: getOrder,\n//   taxesCharge: taxesCharge,\n//   makePayment: makePayment,\n//   updatePremiumFailed: updatePremiumFailed,\n//   updatePremiumSuccesfull: updatePremiumSuccesfull,\n//   getNextNumberBill: getNextNumberBill,\n//   numerateBills: numerateBills,\n//   clickToPayComunication: clickToPayComunication,\n//   redsysComunication: redsysComunication,\n//   checkCreditCard: checkCreditCard\n// };\n","markerStore":{"nextMarkerId":68,"markersById":{"0":{"range":{"start":{"row":693,"column":1},"end":{"row":693,"column":1}},"properties":{"type":"selection","editorId":28,"goalScreenRange":null,"autoscroll":false,"preserveFolds":true},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"54":{"range":{"start":{"row":0,"column":0},"end":{"row":694,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"55":{"range":{"start":{"row":693,"column":3},"end":{"row":693,"column":4}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"56":{"range":{"start":{"row":679,"column":20},"end":{"row":679,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"58":{"range":{"start":{"row":0,"column":0},"end":{"row":694,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":{"start":{"row":693,"column":3},"end":{"row":693,"column":4}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"60":{"range":{"start":{"row":679,"column":20},"end":{"row":679,"column":21}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"63":{"range":{"start":{"row":0,"column":0},"end":{"row":694,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":{"start":{"row":0,"column":0},"end":{"row":694,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":{"start":{"row":0,"column":0},"end":{"row":694,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}},"version":2},"history":{"version":2,"nextCheckpointId":11,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/home/bellahora-04/Downloads/portal/common/utils/paymentSystem/utils.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"f4a78e22ec51779652544596c0e82680eb71bd6d","deserializer":"TextBuffer","version":2},{"text":"{\n  \"author\": \"Carlos LÃ³pez\",\n  \"name\": \"Bellahora\",\n  \"description\": \"\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"dependencies\": {\n    \"apn\": \"^1.7.5\",\n    \"async\": \"^1.5.0\",\n    \"awssum-amazon-ses\": \"^1.0.0\",\n    \"bcryptjs\": \"^2.3.0\",\n    \"bluebird\": \"^3.0.5\",\n    \"connect-mongo\": \"^0.8.2\",\n    \"cors\": \"^2.7.1\",\n    \"date-utils\": \"^1.2.14\",\n    \"debug\": \"^2.2.0\",\n    \"device\": \"^0.3.2\",\n    \"ejs\": \"^2.3.4\",\n    \"express\": \"^3.3.7\",\n    \"express-redis-cache\": \"^0.1.9\",\n    \"express.io\": \"1.1.13\",\n    \"google-places\": \"0.0.2\",\n    \"googleapis\": \"^2.1.6\",\n    \"intl\": \"^1.0.1\",\n    \"ipware\": \"0.0.7\",\n    \"is_js\": \"^0.7.4\",\n    \"json2csv\": \"^3.0.1\",\n    \"less\": \"^2.5.3\",\n    \"lodash\": \"^3.10.1\",\n    \"mandrill-api\": \"^1.0.40\",\n    \"mimelib\": \"^0.2.12\",\n    \"moment\": \"^2.10.6\",\n    \"mongoose\": \"^3.8.36\",\n    \"mongoose-schema-extend\": \"^0.1.7\",\n    \"node-curl\": \"^0.3.3\",\n    \"node-gcm\": \"^0.12.0\",\n    \"node-gettext\": \"^1.0.1\",\n    \"object-hash\": \"^0.9.2\",\n    \"optimist\": \"^0.6.0\",\n    \"passport\": \"^0.3.2\",\n    \"passport-facebook\": \"^2.0.0\",\n    \"passport-local\": \"^1.0.0\",\n    \"promised-io\": \"^0.3.3\",\n    \"randomstring\": \"^1.1.3\",\n    \"raven\": \"^0.8.1\",\n    \"redis\": \"^2.3.0\",\n    \"request\": \"^2.27.0\",\n    \"restler\": \"^3.2.2\",\n    \"sitemap\": \"^1.4.0\",\n    \"stack-trace\": \"0.0.9\",\n    \"string\": \"^3.0.0\",\n    \"underscore\": \"^1.8.2\",\n    \"validate.js\": \"^0.9.0\",\n    \"winston\": \"^2.1.0\",\n    \"winston-logentries\": \"^1.0.1\",\n    \"wkhtmltopdf\": \"^0.1.5\",\n    \"xml2js\": \"^0.4.15\",\n    \"xmlbuilder\": \"^4.0.0\"\n  }\n}\n","markerStore":{"nextMarkerId":177,"markersById":{"0":{"range":{"start":{"row":20,"column":15},"end":{"row":20,"column":27}},"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"161":{"range":{"start":{"row":7,"column":0},"end":{"row":15,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"162":{"range":{"start":{"row":17,"column":0},"end":{"row":20,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"163":{"range":{"start":{"row":22,"column":0},"end":{"row":28,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"164":{"range":{"start":{"row":29,"column":0},"end":{"row":34,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"165":{"range":{"start":{"row":35,"column":0},"end":{"row":36,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"166":{"range":{"start":{"row":37,"column":0},"end":{"row":40,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"167":{"range":{"start":{"row":41,"column":0},"end":{"row":49,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"168":{"range":{"start":{"row":50,"column":0},"end":{"row":54,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"169":{"range":{"start":{"row":55,"column":0},"end":{"row":58,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"176":{"range":{"start":{"row":20,"column":15},"end":{"row":20,"column":27}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}},"version":2},"history":{"version":2,"nextCheckpointId":50,"undoStack":[{"type":"checkpoint","id":2,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"34":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":"^","newText":""}},{"type":"checkpoint","id":3,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"35":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":4,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"36":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":"4","newText":""}},{"type":"checkpoint","id":5,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"37":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":6,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"38":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":".","newText":""}},{"type":"checkpoint","id":7,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"39":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":8,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"40":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":"2","newText":""}},{"type":"checkpoint","id":9,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"41":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":10,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"42":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":".","newText":""}},{"type":"checkpoint","id":11,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"43":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":12,"snapshot":{"0":{"range":[[32,17],[32,18]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"44":{"range":[[32,17],[32,18]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,17],[32,18]],"newRange":[[32,17],[32,17]],"oldText":"5","newText":""}},{"type":"checkpoint","id":13,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"20":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"21":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"22":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"23":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"24":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"25":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"26":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"27":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"28":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"29":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"45":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":14,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"45":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"46":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"47":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"48":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"49":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"50":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"51":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"52":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"53":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"54":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"55":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":15,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"45":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"46":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"47":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"48":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"49":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"50":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"51":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"52":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"53":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"54":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"55":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":16,"snapshot":{"0":{"range":[[32,17],[32,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"45":{"range":[[32,17],[32,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"46":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"47":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"48":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"49":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"50":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"51":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"52":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"53":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"54":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"55":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[32,0],[32,0]],"newRange":[[32,0],[33,0]],"oldText":"","newText":"    \"mongoose\": \"^3.8.36\",\n"}},{"type":"change","content":{"oldRange":[[33,0],[34,0]],"newRange":[[33,0],[33,0]],"oldText":"    \"mongoose\": \"\",\n","newText":""}},{"type":"checkpoint","id":17,"snapshot":{"0":{"range":[[33,0],[33,0]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"46":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"47":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"48":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"49":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"50":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"51":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"52":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"53":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"54":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"55":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":18,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"71":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":"^","newText":""}},{"type":"checkpoint","id":19,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"72":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":20,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"73":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":"4","newText":""}},{"type":"checkpoint","id":21,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"74":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":22,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"75":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":".","newText":""}},{"type":"checkpoint","id":23,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"76":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":24,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"77":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":"1","newText":""}},{"type":"checkpoint","id":25,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"78":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":26,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"79":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":"3","newText":""}},{"type":"checkpoint","id":27,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"80":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":28,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"81":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":".","newText":""}},{"type":"checkpoint","id":29,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"58":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"59":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"60":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"61":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"62":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"63":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"64":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"65":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"66":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"67":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"82":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":30,"snapshot":{"0":{"range":[[18,16],[18,17]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"83":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"84":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"85":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"86":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"87":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"88":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"89":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"90":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"91":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"92":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"93":{"range":[[18,16],[18,17]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,16],[18,17]],"newRange":[[18,16],[18,16]],"oldText":"3","newText":""}},{"type":"checkpoint","id":31,"snapshot":{"0":{"range":[[18,16],[18,16]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"83":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"84":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"85":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"86":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"87":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"88":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"89":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"90":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"91":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"92":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"94":{"range":[[18,16],[18,16]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":32,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"120":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":"^","newText":""}},{"type":"checkpoint","id":33,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"121":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":34,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"122":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":"0","newText":""}},{"type":"checkpoint","id":35,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"123":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":36,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"124":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":".","newText":""}},{"type":"checkpoint","id":37,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"125":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":38,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"126":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":"1","newText":""}},{"type":"checkpoint","id":39,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"127":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":40,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"128":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":".","newText":""}},{"type":"checkpoint","id":41,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"96":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"97":{"range":[[17,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"98":{"range":[[19,0],[19,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"99":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"100":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"101":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"102":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"103":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"104":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"105":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"129":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":42,"snapshot":{"0":{"range":[[19,28],[19,29]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"130":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"131":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"132":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"133":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"134":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"135":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"136":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"137":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"138":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"139":{"range":[[19,28],[19,29]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,28],[19,29]],"newRange":[[19,28],[19,28]],"oldText":"8","newText":""}},{"type":"checkpoint","id":43,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"130":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"131":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"132":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"133":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"134":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"135":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"136":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"137":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"138":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true}}},{"type":"checkpoint","id":44,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"141":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"142":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"143":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"144":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"145":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"146":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"147":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"148":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"149":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":45,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"141":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"142":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"143":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"144":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"145":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"146":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"147":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"148":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"149":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":46,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"141":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"142":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"143":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"144":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"145":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"146":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"147":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"148":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"149":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[18,0],[18,0]],"newRange":[[18,0],[19,0]],"oldText":"","newText":"    \"express\": \"^3.3.7\",\n"}},{"type":"change","content":{"oldRange":[[19,0],[20,0]],"newRange":[[19,0],[19,0]],"oldText":"    \"express\": \"\",\n","newText":""}},{"type":"checkpoint","id":47,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"141":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"142":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"143":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"144":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"145":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"146":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"147":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"148":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"149":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"checkpoint","id":48,"snapshot":{"0":{"range":[[19,28],[19,28]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"140":{"range":[[19,28],[19,28]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"overlap","maintainHistory":true},"150":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"151":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"152":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"153":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"154":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"155":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"156":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"157":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"158":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}},{"type":"change","content":{"oldRange":[[19,0],[19,0]],"newRange":[[19,0],[20,0]],"oldText":"","newText":"    \"express-redis-cache\": \"^0.1.9\",\n"}},{"type":"change","content":{"oldRange":[[20,0],[21,0]],"newRange":[[20,0],[20,0]],"oldText":"    \"express-redis-cache\": \"\",\n","newText":""}},{"type":"checkpoint","id":49,"snapshot":{"0":{"range":[[20,0],[20,0]],"properties":{"type":"selection","editorId":34,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"150":{"range":[[7,0],[15,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"151":{"range":[[17,0],[20,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"152":{"range":[[22,0],[28,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"153":{"range":[[29,0],[34,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"154":{"range":[[35,0],[36,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"155":{"range":[[37,0],[40,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"156":{"range":[[41,0],[49,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"157":{"range":[[50,0],[54,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true},"158":{"range":[[55,0],[58,0]],"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}}}],"redoStack":[]},"encoding":"utf8","filePath":"/home/bellahora-04/Downloads/portal/package.json","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"dfd1728ea7e267b48389d152e76b67756b9fffcb","deserializer":"TextBuffer","version":2},{"text":"var config = require('./config'),\n    bcrypt = require('bcryptjs'),\n    passport = require('passport'),\n    crypto = require('crypto'),\n    LocalStrategy = require('passport-local').Strategy,\n    FacebookStrategy = require('passport-facebook').Strategy,\n    User = require('./common/model/User.js').model(),\n    UserAgent = require('./common/model/UserAgent.js').model(),\n    Mapper = require('./common/utils/mapper.js'),\n    functions = require('./common/utils/functions'),\n    util = require('util');\n\nmodule.exports = function() {\n\n    passport.use(new LocalStrategy(function(username, password, done) {\n            User.findOne({ email: functions.cleanEmail(username), blocked: {$ne: true}}, function (err, user) {\n                if (err) { return done(err); }\n                if (!user) {\n                    return done(null, false, { message: 'Incorrect username.' , err: 'NO_USER' });\n                }\n                if( config.environment === \"development\" ) {\n                    return done( null , user );\n                }\n                if ( (typeof user.password === \"undefined\") || !bcrypt.compareSync(password, user.password)  ) {\n                    return done(null, false, { message: 'Invalid password', err: 'INVALID_PASSWORD' });\n                }\n                return done(null, user);\n            });\n        }\n    ));\n\n\n    passport.use( 'api-token' , new LocalStrategy(\n        {\n            usernameField: 'agent_name',\n            passwordField: 'token',\n            passReqToCallback: true\n        },\n        function(req, agentName, token, done) {\n\n            UserAgent.findOne({ name : agentName, token: crypto.createHash('sha1').update(token).digest('hex') }, function(err, agent){\n                if (err) { return done(err); }\n                if (!agent) {\n                    return done(null, false, { message: 'Incorrect agent name.' });\n                }\n                User.findOne({ _id: agent.idUser, blocked: {$ne: true}}, function (err, user) {\n                    if (err) { return done(err); }\n                    if(!user) {\n                        return done(null, false, { message: 'User not found'});\n                    }\n                    done(null, user);\n                });\n            });\n        }\n    ));\n\n    passport.use(new FacebookStrategy(\n        config.facebook,\n        function(access_token, refresh_token, profile, done) {\n\n            process.nextTick(function() {\n\n                User.findOne({\n                    blocked: {$ne: true},\n                    $or: [\n                        {'facebook' : profile._json.id },\n                        {'email': functions.cleanEmail(profile._json.email) }\n                    ]\n                }, function(err, user) {\n\n                    if ( err || !profile._json.email ) {\n                        return done(err);\n                    }\n                    if ( user ) {\n                        if ( user.facebook ) {\n                            return done( null, user );\n                        } else {\n                            User.update(\n                                { _id     : user._id },\n                                { $set    : {facebook : profile._json.id}},\n                                function( err ) {\n                                    if ( err ) { throw err; }\n                                    return done(null, user);\n                                }\n                            )\n                        }\n                    } else {\n                        var newUser = new User();\n                        newUser.isNew    = true;\n                        newUser.name     = profile._json.first_name;\n                        newUser.lastname = profile._json.last_name;\n                        newUser.email    = functions.cleanEmail(profile._json.email);\n                        newUser.gender   = profile._json.gender;\n                        newUser.facebook = profile._json.id;\n                        return done(null, newUser);\n                        /*newUser.save(function(err) {\n                            if (err) { throw err; }\n                        });*/\n                    }\n                });\n            });\n        }));\n\n    passport.serializeUser(function(user, done) {\n        if( !user || !user._id ) {\n            return done('ERROR SERIALIZE USER' , false );\n        }\n        done(null, user._id);\n    });\n\n    passport.deserializeUser(function(id, done) {\n        User.findById(id, function (err, user) {\n            if (user.blocked) {\n                return done(err, null);\n            }\n            done(err, user);\n        });\n    });\n};\n","markerStore":{"nextMarkerId":4,"markersById":{"0":{"range":{"start":{"row":0,"column":0},"end":{"row":0,"column":0}},"properties":{"type":"selection","editorId":42,"goalScreenRange":null},"reversed":false,"tailed":false,"valid":true,"invalidate":"never","maintainHistory":true},"3":{"range":{"start":{"row":1,"column":0},"end":{"row":2,"column":0}},"properties":{},"reversed":false,"tailed":true,"valid":true,"invalidate":"never","maintainHistory":true}},"version":2},"history":{"version":2,"nextCheckpointId":2,"undoStack":[],"redoStack":[]},"encoding":"utf8","filePath":"/home/bellahora-04/Downloads/portal/passport.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"dda1c464865d04983914c7e896b33341abd50089","deserializer":"TextBuffer","version":2}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":20,"softTabs":false,"displayBuffer":{"id":21,"softWrapped":true,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/home/bellahora-04/Downloads/portal/controller/UserController.js","largeFileMode":false,"deserializer":"TokenizedBuffer"},"largeFileMode":false,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"},{"id":34,"softTabs":true,"displayBuffer":{"id":35,"softWrapped":true,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/home/bellahora-04/Downloads/portal/package.json","largeFileMode":false,"deserializer":"TokenizedBuffer"},"largeFileMode":false,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"},{"id":42,"softTabs":true,"displayBuffer":{"id":43,"softWrapped":true,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/home/bellahora-04/Downloads/portal/passport.js","largeFileMode":false,"deserializer":"TokenizedBuffer"},"largeFileMode":false,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"},{"id":28,"softTabs":true,"displayBuffer":{"id":29,"softWrapped":true,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/home/bellahora-04/Downloads/portal/common/utils/paymentSystem/utils.js","largeFileMode":false,"deserializer":"TokenizedBuffer"},"largeFileMode":false,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/home/bellahora-04/Downloads/portal/package.json","focused":true,"flexScale":1,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-javascript","language-json","language-hyperlink","language-todo"],"deserializer":"Workspace"},"packageStates":{"linter":{"scope":"File"},"pigments":{"project":{"deserializer":"ColorProject","timestamp":"2015-11-12T10:27:24.870Z","version":"1.0.1","markersVersion":"1.0.5","globalSourceNames":["**/*.styl","**/*.stylus","**/*.less","**/*.sass","**/*.scss"],"globalIgnoredNames":["vendor/*","node_modules/*","spec/*","test/*"],"buffers":{"20":{"id":20,"path":"/home/bellahora-04/Downloads/portal/controller/UserController.js","colorMarkers":[]},"28":{"id":28,"path":"/home/bellahora-04/Downloads/portal/common/utils/paymentSystem/utils.js","colorMarkers":[]},"34":{"id":34,"path":"/home/bellahora-04/Downloads/portal/package.json","colorMarkers":[]},"42":{"id":42,"path":"/home/bellahora-04/Downloads/portal/passport.js","colorMarkers":[]}},"paths":["/home/bellahora-04/Downloads/portal/static/css/basics.less","/home/bellahora-04/Downloads/portal/static/css/basics_ui.less","/home/bellahora-04/Downloads/portal/static/css/variables.less"],"variables":{"deserializer":"VariablesCollection","content":[{"name":"@params","value":"all ease 0.3s","path":"/home/bellahora-04/Downloads/portal/static/css/basics.less","range":[4818,4840],"line":199},{"name":"@host","value":"\"s3\"","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[21,33],"line":1},{"name":"@color-strong","value":"#8062A4","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[45,67],"line":4,"isColor":true,"color":[128,98,164,1],"variables":[]},{"name":"@color-light","value":"mix( @color-strong , #fff , 20% )","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[69,116],"line":5,"isColor":true,"color":[229,223,236,1],"variables":[]},{"name":"@font-primary","value":"'Open Sans'","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[127,153],"line":8},{"name":"@font-title","value":"'Open Sans'","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[155,179],"line":9},{"name":"@color-primary","value":"#ff0b6d","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[202,225],"line":13,"isColor":true,"color":[255,11,109,1],"variables":[]},{"name":"@text-color","value":"#757575","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[228,248],"line":15,"isColor":true,"color":[117,117,117,1],"variables":[]},{"name":"@soft-text-color","value":"#747474","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[251,275],"line":17,"isColor":true,"color":[116,116,116,1],"variables":[]},{"name":"@hover-gray","value":"#A9A9A9","path":"/home/bellahora-04/Downloads/portal/static/css/variables.less","range":[278,298],"line":19,"isColor":true,"color":[169,169,169,1],"variables":[]}]}}},"fuzzy-finder":{"/home/bellahora-04/Downloads/portal/controller/UserController.js":1447322988144,"/home/bellahora-04/Downloads/portal/package.json":1447323558491,"/home/bellahora-04/Downloads/portal/passport.js":1447323558071,"/home/bellahora-04/Downloads/portal/common/utils/paymentSystem/utils.js":1447148061605},"keybinding-resolver":{},"metrics":{"sessionLength":1056816},"tabs":[{"previewTabURI":"/home/bellahora-04/Downloads/portal/passport.js"}],"tree-view":{"directoryExpansionStates":{"/home/bellahora-04/Downloads/portal":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"certificates":{"isExpanded":false,"entries":{}},"common":{"isExpanded":true,"entries":{"controller":{"isExpanded":false,"entries":{}},"model":{"isExpanded":false,"entries":{}},"utils":{"isExpanded":true,"entries":{"agreement":{"isExpanded":false,"entries":{}},"commissions":{"isExpanded":false,"entries":{}},"geoip":{"isExpanded":false,"entries":{}},"paymentSystem":{"isExpanded":true,"entries":{"cleanDB":{"isExpanded":false,"entries":{}}}},"podio":{"isExpanded":false,"entries":{}},"shade":{"isExpanded":false,"entries":{}},"workcollisions":{"isExpanded":false,"entries":{}}}}}},"controller":{"isExpanded":true,"entries":{"abstract":{"isExpanded":false,"entries":{}}}},"helpers":{"isExpanded":false,"entries":{}},"middlewares":{"isExpanded":false,"entries":{}},"node_modules":{"isExpanded":false,"entries":{}},"painter":{"isExpanded":false,"entries":{}},"resources":{"isExpanded":false,"entries":{}},"routings":{"isExpanded":true,"entries":{"api":{"isExpanded":true,"entries":{}},"helpers":{"isExpanded":false,"entries":{}}}},"services":{"isExpanded":false,"entries":{}},"static":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/home/bellahora-04/Downloads/portal/package.json","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":63,"width":200}}}